import React, { useEffect } from 'react';
import * as echarts from 'echarts';


const DetailViewB = () => {
  const rawData = [
    ['Year', '上海', '北京', '广州', '深圳', '成都', '杭州', '南京', '重庆', '武汉', '西安', '天津'],
    [1993, 1295, 794, 603, 441, 330, 343, 300, 519, 295, 229, 461],
          [1994, 1628, 946, 800, 495, 416, 461, 382, 660, 386, 289, 583],
          [1995, 2187, 1280, 1087, 712, 559, 651, 514, 941, 530, 330, 806],
          [1996, 2629, 1579, 1309, 892, 677, 796, 608, 1169, 649, 406, 977],
          [1997, 3089, 1870, 1515, 1104, 795, 935, 703, 1358, 811, 488, 1154],
          [1998, 3562, 2178, 1735, 1360, 898, 1062, 794, 1534, 936, 525, 1293],
          [1999, 3928, 2483, 1955, 1602, 982, 1157, 872, 1617, 1022, 577, 1406],
          [2000, 4439, 2897, 2269, 1945, 1086, 1283, 987, 1710, 1130, 646, 1575],
          [2001, 5119, 3596, 2733, 2390, 1270, 1510, 1173, 1919, 1295, 734, 1851],
          [2002, 5585, 4152, 3062, 2779, 1423, 1698, 1320, 2133, 1416, 826, 2060],
          [2003, 6631, 5008, 3683, 3502, 1676, 2056, 1649, 2512, 1601, 926, 2520],
          [2004, 7871, 5942, 4305, 4136, 1962, 2450, 1988, 2934, 1827, 1092, 3023],
          [2005, 9023, 6870, 4959, 4765, 2280, 2832, 2345, 3347, 2156, 1294, 3724],
          [2006, 10398, 8035, 5862, 5609, 2678, 3325, 2735, 3803, 2580, 1512, 4383],
          [2007, 12274, 9716, 6926, 6602, 3245, 3970, 3235, 4521, 3102, 1857, 5158],
          [2008, 13970, 11141, 8069, 7599, 3834, 4658, 3724, 5581, 3943, 2313, 6528],
          [2009, 15197, 12329, 9063, 8246, 4453, 5083, 4193, 6465, 4576, 2689, 7555],
          [2010, 17541, 14554, 10834, 9863, 5623, 6020, 5182, 8033, 5627, 3195, 9467],
          [2011, 19494, 16587, 12392, 11483, 6924, 7017, 6126, 9972, 6739, 3791, 11440],
          [2012, 20307, 17934, 13278, 12620, 7852, 7641, 6946, 11072, 7704, 4370, 12717],
          [2013, 21802, 19801, 14977, 14145, 8849, 8247, 7845, 12416, 8771, 4960, 14268],
          [2014, 23921, 21819, 16613, 15891, 9983, 9143, 8763, 14148, 9990, 5576, 15901],
          [2015, 25622, 23662, 18081, 17482, 10791, 10039, 9708, 15697, 10894, 5932, 16826],
          [2016, 28377, 25905, 19745, 19791, 12344, 11440, 10626, 17756, 12064, 6396, 17957],
          [2017, 29239, 26933, 21052, 21759, 13493, 12270, 11435, 19052, 13065, 7418, 18431],
          [2018, 31839, 29373, 22302, 24126, 14746, 13137, 12366, 19978, 14257, 8181, 18703],
          [2019, 38155, 35371, 23629, 26927, 17013, 15373, 14030, 23606, 16223, 9321, 14104],
          [2020, 38701, 36103, 25019, 26360, 17717, 16016, 14818, 25003, 15623, 10020, 14084],
          [2021, 43214, 40269, 28232, 30663, 19917, 18109, 16355, 27894, 17716, 10688, 15685],
          [2022, 44652, 41610, 28839, 32387, 20817, 18753, 16907, 29129, 18866, 11486, 16311]
  ];

  const cities = ['上海', '北京', '广州', '深圳', '成都', '杭州', '南京', '重庆', '武汉', '西安', '天津'];
  
  useEffect(() => {
    const chartDom = document.getElementById('main');
    const myChart = echarts.init(chartDom);
    
    const datasetWithFilters = [];
    const seriesList = [];
    echarts.util.each(cities, function (city) {
      var datasetId = `dataset_${city}`;
      datasetWithFilters.push({
        id: datasetId,
        fromDatasetId: `dataset_raw`,
        transform: {
          type: `filter`,
          config: {
            dimension: city
          }
        }
      });
      seriesList.push({
        type: `line`,
        datasetId: datasetId,
        smooth: true,
        showSymbol: false,
        lineStyle:{
          width:1,
          
        },
        name: city,
        endLabel: {
          show:true,
          formatter: function (params) {
            return ':::';
          }
        },
        labelLayout: {
          moveOverlap: `shiftY`
        },
        emphasis: {
          focus: `series`
        },
        
        encode: {
          x: `Year`,
          y: city,
          label: [city],
          itemName: `Year`,
          tooltip: [city]
        }
      });
    });

    const option = {
      animationDuration: 8000,
      dataset: [
        {
          id: `dataset_raw`,
          source: rawData
        },
        ...datasetWithFilters
      ],
      title: {
        text: `1993-2022年主要城市国内生产总值变化`,
        x:"center",
        y:"20px",
      },
      tooltip: {
        order: `valueDesc`,
        trigger: `axis`
      },
      xAxis: {
        type: `category`,
        nameLocation: `middle`
      },
      yAxis: {
        name: `国内生产总值(亿元)`
      },
      
      grid: {
      },
      series: seriesList
    };
    
    myChart.setOption(option);
    
    return () => myChart.dispose();
    
}, []);

  return  <div style={{ width: '100%', height: '100%' }} id="main"></div>;
};

export default DetailViewB;